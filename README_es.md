<h1 align="center">
  <img alt="ALT logo" src="https://github.com/alexminator/ALT_nano/blob/master/img/ALT_logo.png" width="300px"/><br/><strong>Another Level Tank</strong>
  
  <a href="https://github.com/alexminator/ALT_nano/blob/master/README_es.md">
    <img height="20px" src="https://img.shields.io/badge/ES-flag.svg?color=555555&style=flat-square&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NTAgNTAwIj4NCjxwYXRoIGZpbGw9IiNjNjBiMWUiIGQ9Im0wLDBoNzUwdjUwMGgtNzUweiIvPg0KPHBhdGggZmlsbD0iI2ZmYzQwMCIgZD0ibTAsMTI1aDc1MHYyNTBoLTc1MHoiLz4NCjwvc3ZnPg0K">
  </a>
  <a href="https://github.com/alexminator/ALT_nano/blob/master/README.md">
    <img height="20px" src="https://img.shields.io/badge/EN-flag.svg?color=555555&style=flat-square&logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgNjAgMzAiIGhlaWdodD0iNjAwIj4NCjxkZWZzPg0KPGNsaXBQYXRoIGlkPSJ0Ij4NCjxwYXRoIGQ9Im0zMCwxNWgzMHYxNXp2MTVoLTMwemgtMzB2LTE1enYtMTVoMzB6Ii8+DQo8L2NsaXBQYXRoPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzAwMjQ3ZCIgZD0ibTAsMHYzMGg2MHYtMzB6Ii8+DQo8cGF0aCBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iNiIgZD0ibTAsMGw2MCwzMG0wLTMwbC02MCwzMCIvPg0KPHBhdGggc3Ryb2tlPSIjY2YxNDJiIiBzdHJva2Utd2lkdGg9IjQiIGQ9Im0wLDBsNjAsMzBtMC0zMGwtNjAsMzAiIGNsaXAtcGF0aD0idXJsKCN0KSIvPg0KPHBhdGggc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjEwIiBkPSJtMzAsMHYzMG0tMzAtMTVoNjAiLz4NCjxwYXRoIHN0cm9rZT0iI2NmMTQyYiIgc3Ryb2tlLXdpZHRoPSI2IiBkPSJtMzAsMHYzMG0tMzAtMTVoNjAiLz4NCjwvc3ZnPg0K">
  </a>
</h1>

<a name="readme-top"></a>

<h1 align="center">
  
[![GitHub repo size](https://img.shields.io/github/repo-size/alexminator/ALT_nano?logo=github&style=plastic)](https://github.com/alexminator/ALT_nano/)
[![GitHub License](https://img.shields.io/github/license/alexminator/ALT_nano.svg?logo=github&style=plastic&colorB=68B7EB)](https://github.com/alexminator/ALT_nano/blob/master/LICENSE) 
[![GitHub stars](https://img.shields.io/github/stars/alexminator/ALT_nano.svg?style=plastic&logo=github&color=yellow)](https://github.com/alexminator/ALT_nano/stargazers) 
[![GitHub forks](https://img.shields.io/github/forks/alexminator/ALT_nano.svg?logo=github&color=teal&style=plastic)](https://github.com/alexminator/ALT_nano/network/members)
[![GitHub top language](https://img.shields.io/github/languages/top/alexminator/ALT_nano?logo=github&style=plastic&color=blueviolet)](https://github.com/alexminator/ALT_nano/)
[![GitHub contributors](https://img.shields.io/github/contributors/alexminator/ALT_nano?logo=github&style=plastic)](https://github.com/alexminator/ALT_nano/)
[![Watchers](https://img.shields.io/github/watchers/alexminator/ALT_nano?logo=github&color=teal&style=plastic)](https://github.com/alexminator/ALT_nano/watchers)  
</h1> 

<h4 align="center">:star: Dame una estrella ‚Äî me motivar√° a seguir mejor√°ndolo!</h4>

<!-- TABLE OF CONTENTS -->
<details>
  <summary>Tabla de Contenido</summary>
  <ol>
    <li>
      <a href="#sobre-el-proyecto">Sobre el proyecto</a>
      <ul>
        <li><a href="#metas">Metas</a></li>
      </ul>
    </li>
    <li>
      <a href="#comencemos">Comencemos</a>
      <ul>
        <li><a href="#componentes">Componentes</a></li>
        <li><a href="#instalaci√≥n">Instalaci√≥n</a></li>
        <li><a href="#diagrama">Diagrama</a></li>
        <li><a href="#c√≥digo">C√≥digo</a></li>
      </ul>
    </li>
    <li><a href="#por-hacer">Por hacer</a></li>
    <li><a href="#colaboradores">Colaboradores</a></li>
    <li><a href="#licencia">Licencia</a></li>
    <li><a href="#contacto">Contacto</a></li>
    <li><a href="#programas">Programas</a></li>
    <li><a href="#agradecimientos">Agradecimientos</a></li>
  </ol>
</details>

<!-- ABOUT THE PROJECT -->
## Sobre el proyecto

*Este proyecto es una versi√≥n m√°s de un dispositivo para monitorear el nivel de agua en un tanque. El sistema de monitoreo de agua es un sistema de medici√≥n de nivel de l√≠quido para mantener al usuario alertado en caso de desbordamiento de l√≠quido o cuando el tanque se agota. Se fijar√° un sensor ultras√≥nico, que se colocar√° sobre el tanque apuntando al l√≠quido. El sensor ultras√≥nico se utiliza para medir, comparar la profundidad del contenedor y el nivel de l√≠quido. El estado del sistema podr√° monitorearse mediante una pantalla LCD y un zumbador suena cuando el l√≠mite excede la cantidad de llenado permitida o decae por debajo de un l√≠mite fijado. Mediante el bot√≥n podremos silenciar las alarmas con una pulsaci√≥n larga y tambi√©n encender la luz de fondo del LCD para mejor visi√≥n con una pulsaci√≥n corta.*

**Puedes ver una demo [aqui](https://wokwi.com/projects/356392498196222977).**
> **Warning** :
Una vez dentro de la web de WOKWI pulsa el bot√≥n PLAY para iniciar la simulaci√≥n. Cuando comience la simulaci√≥n, sonar√° la alarma de nivel alto. Mantenga presionado el bot√≥n hasta que se silencie la alarma. Haga clic en el sensor ultras√≥nico y aparecer√° un control deslizante para simular los valores de lectura del sensor. Var√≠e los valores entre 25 y 104 cm para ver la animaci√≥n de llenado del tanque. Donde 25 cm es tanque lleno y 104 cm (altura del tanque) es totalmente vac√≠o. El sensor JSN-SR04T tiene una zona muerta de 25 cm.

### Metas 

- **_Monitoreo 24/7 del nivel de tanque_**
- **_Evitar derramamiento de agua por desbordamiento_**
- **_Evitar que el tanque quede vacio y deje la casa sin suminsitro de agua_**

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---

<!-- GETTING STARTED -->
## Comencemos

[![Arduino](https://img.shields.io/badge/Arduino-Project-teal.svg?colorA=teal&colorB=red&style=for-the-badge)](https://github.com/alexminator/ALT_nano/)

```js
         .8.          8 8888         8888888 8888888888
        .888.         8 8888               8 8888
       :88888.        8 8888               8 8888
      . `88888.       8 8888               8 8888
     .8. `88888.      8 8888               8 8888
    .8`8. `88888.     8 8888               8 8888
   .8' `8. `88888.    8 8888               8 8888
  .8'   `8. `88888.   8 8888               8 8888
 .888888888. `88888.  8 8888               8 8888
.8'       `8. `88888. 8 888888888888       8 8888

```
### Componentes

*Para este proyecto use un Arduino nano debido a su peque√±o tama√±o, al cual se le conectara un sensor y actuadores. Para mostrar la informaci√≥n se eligi√≥ una pantalla LCD de 20x4 con espacio suficiente para dibujar una animaci√≥n del llenado del tanque. Un zumbador para la notificaci√≥n y un bot√≥n para control. Para una mayor duraci√≥n de vida del sensor ultras√≥nico se escogi√≥ el **JSN-SR04T** el cual es a prueba de agua. Si no posee este sensor y utiliza otro cerci√≥rese de protegerlo contra la humedad.*

Los componentes necesarios son:

- **Arduino Nano**
- **Pantalla LCD 20x4**
- **Bot√≥n**
- **Zumbador**
- **Resitencia valor 10K**
- **Sensor ultras√≥nico a prueba de agua [JSN-SR04T](https://naylampmechatronics.com/img/cms/Datasheets/JSN-SR04T-2-0.pdf)**

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---

### Instalaci√≥n 

*A continuaci√≥n se muestra el diagrama de conexiones y una tabla con los pines que se conectar√°n.*

| ARDUINO PINS | LCD PINS    |  
| ------------ | ----------- | 
|  12-  `D12`  |   15 - `A`  |
|  11-  `D11`  |   4 - `RS`  |
|  10-  `D10`  |   6 - `E`   |
|  9-  `D9`    |   11 - `D4` |
|  8-  `D8`    |   12 - `D5` |
|  7-  `D7`    |   13 - `D6` |
|  6-  `D6`    |   14 - `D7` |
|    GND       |   16 - `K`  |
|    GND       |   1 - `VSS` |
|   VCC(5v)    |   2 - `VDD` |
| ARDUINO PINS | BUTTON PINS | 
|  3-  `D3`    |   1 - 3     | 
|    GND       |   2 - 4     |  
| ARDUINO PINS | BUZZER PINS |
|  4-  `D4`    |     +       |
|    GND       |     -       |
| ARDUINO PINS | JSN-SR04T   |
|  2-  `D2`    |  `TRIGGER`  |
|  3-  `D5`    |   `ECHO`    |
|   VCC(5v)    |    VCC      |
|    GND       |    GND      |

> **Warning** :
Del pin 1-3 del bot√≥n conectar una resistencia de 10 k a VCC (5v).

### Diagrama

![Diagram](https://github.com/alexminator/ALT_nano/blob/master/img/diagrama.jpg?raw=true)

> ### :point_right: Puede encontrar el esquema [aqu√≠](https://github.com/alexminator/ALT_nano/blob/master/img/ALT-UNO.fzz). :star:

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>
---

## C√≥digo

*El c√≥digo consta de una librer√≠a local llamada Tank que es la encargada del dibujo del tanque en la pantalla. Solo se us√≥ una librer√≠a global **LiquidCrystal** para el manejo de la pantalla. Si posee una pantalla con I2C deber√° sustituir esta librer√≠a por **LiquidCrystal_I2C** e inicializarla de forma diferente a como esta en el proyecto manteniendo el nombre como lcd.
El resto de las librer√≠as son para el manejo de las alarmas, los tonos de las alarmas, animaci√≥n del llenado del tanque, filtro de medici√≥n, depurado de c√≥digo y tipo de letra.*

*Para activar el depurador el c√≥digo debe quedar as√≠:*

```c
#define DEBUGLEVEL DEBUGLEVEL_DEBUGGING
//#define DEBUGLEVEL DEBUGLEVEL_NONE
```
*Puede variar el nivel de depuraci√≥n si as√≠ lo desea, para ello rem√≠tase a la librer√≠a **debug.h** y elija el nivel que necesite.
Se crean los objetos Button, Sensor y Draw. El objeto Button se encarga del control del bot√≥n, que sirve para silenciar las alarmas por alto y bajo nivel y encender la luz de fondo de la pantalla. El objeto sensor devuelve la distancia medida por el sensor ultras√≥nico para ser usada en el c√°lculo del volumen de l√≠quido y el nivel de la columna liquida en porciento. Por √∫ltimo, el objeto draw dibujara cada uno de los 8 posibles [glyphs](https://www.techtarget.com/whatis/definition/glyph) que se pueden usar para generar la animaci√≥n del llenado del tanque.*

*El sensor ultras√≥nico mide la cantidad de espacio vac√≠o en el tanque, o sea la distancia que existe entre √©l y el agua contenida en el tanque. Por lo tanto, si conocemos la altura del tanque en vac√≠o **(H)**, al restar la distancia **(D)** de espacio vac√≠o sabremos la altura de la columna de l√≠quido **(C)** que posee. Mira la figura a continuaci√≥n.*

<td align="center"><img src="https://github.com/alexminator/ALT_nano/blob/master/img/fig%202.png" width=500px height=500px alt="fig2"/></td>

*Para el c√°lculo del volumen del tanque hay que tener en cuenta sus medidas, las mismas son introducidas como constantes en el c√≥digo.*

> **Warning** :
Hay que destacar que el tanque para el que fue creado este c√≥digo es at√≠pico. Es un tanque rectangular que posee un tabique en el medio y lo convierte en 2 tanques.  Debido a ese particular se calcula tambi√©n el volumen del tabique hasta la altura de la columna liquida para luego ser restado del volumen general y de como resultado el volumen real de l√≠quido en el tanque.

*Si desean usar este c√≥digo para el c√°lculo de volumen de l√≠quido de su tanque deber√°n modificar las partes del c√≥digo que calculan volumen que se encuentra en la funci√≥n **get_volumen**. Solo debe tener en cuenta si su tanque es cil√≠ndrico o rectangular y usar la formula correspondiente.
Les dejo este [enlace](https://www.calculatorsoup.com/calculators/construction/tank.php) a una web para el c√°lculo de volumen de tanques.* 

*Las constantes m√°s importantes a tener en cuenta son:*
```c
#define DIST_TOPE    //altura del tanque en cm medida con el tanque vac√≠o.
const int NIVEL_BAJO //nivel bajo porcentual a partir del cual se activa la alarma.
const int NIVEL ALTO //nivel alto porcentual a partir del cual se activa la alarma.
```
*La altura del tanque no debe superar la distancia m√°xima que puede medir su sensor ultras√≥nico. Defina un nivel bajo acorde a sus necesidades de llenado del tanque. El nivel alto por lo general se define cercano al 100%.*

> **Warning** :
Aunque se defina como nivel alto 100% y se alcance este nivel esto no significara que su tanque se desbordara. El sensor ultras√≥nico impermeable tiene una zona muerta de medici√≥n de 25 cm en el cual las lecturas no son confiables. Esto se tiene en cuenta en el c√≥digo por lo que el 100% seria la altura del tanque menos 25 cm de rango muerto. Esto ser√≠a teniendo en cuenta que se posicione el sensor a la altura del tanque. Si se coloca m√°s alto tenga cuidado con definir el nivel alto para la alarma. V√©ase la figura a continuaci√≥n. 

<td align="center"><img src="https://github.com/alexminator/ALT_nano/blob/master/img/fig1.png" alt="fig2"/></td>

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---

## Por hacer

*Hacer una versi√≥n universal del proyecto que incluya las siguientes caracter√≠sticas.*

**_Por la parte del software:_**

+ Incluir un men√∫ para configurar **TODAS** las variables posibles.
  - Tipo de tanque. Para un calculo preciso del volumen de agua.
      * Cil√≠ndrico o rectangular.
  - Dimensiones del tanque. La altura del tanque puede ser introducida tanto de forma manual como autom√°tica. 
  - Nivel para activar la alarma por bajo y por alto.
  - Elecci√≥n del modo de trabajo del dispositivo.  
      * Manual, el usuario toma las decisiones.  
      * Autom√°tico, al alcanzar el bajo nivel del tanque se medir√° el nivel en la cisterna si es suficiente se activar√° la bomba y se llenar√° el tanque.
  - Elecci√≥n del tono de alarma.
  - Incluir el flujo de agua entrante a mostrar en la pantalla.
  - Elecci√≥n de la informaci√≥n a mostrar en pantalla.

**_Por la parte del hardware:_**

+ Poder usar diferentes pantallas.  
     - LCD.
     - OLED
+ Aumentar la cantidad de botones a 3, para una f√°cil navegaci√≥n por el men√∫.
+ Agregar modulo rel√© para control de la bomba de llenado del tanque.
+ Agregar un sensor de flujo para protecci√≥n de la bomba de llenado y contabilizar las cantidades de agua que entra al tanque.
+ Agregar un segundo sensor ultras√≥nico para medir el nivel de la cisterna y que el llenado sea autom√°tico al alcanzarse el bajo nivel. 
+ Y por √∫ltimo si el tiempo me alcanza hacer una versi√≥n con esp32 que incluya una web embebida y hacer todo el control desde su m√≥vil.

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---

## Colaboradores

<table style="width:100%">
  <tr>
    <th><b>Alexminator</b></th>
    <th><b>20-EverGreen-2</b></th>
    
  </tr>
  <tr>
    <td align="center"><a href="https://github.com/alexminator"><img src="https://avatars.githubusercontent.com/u/9116486?s=400&v=4" width=150px height=150px alt="alexminator"/></a></td>
    <td align="center"><a href="https://github.com/20-EverGreen-2"><img src="https://avatars.githubusercontent.com/u/84293898?v=4" width="100px;" alt="20-EverGreen-2"></a></td>
    
  </tr>
  <tr>
    <td align="center"><a href="https://twitter.com/alexminator99"><img src="img/twitter-48.png" width="32px" height="32px"></a> <a href="https://www.facebook.com/alexander.rivasalpizar/"><img src="img/facebook-48.png" width="32px" height="32px"></a> <a href="https://www.linkedin.com/in/alexander-rivas-73532037/"><img src="img/linkedin-48.png" width="32px" height="32px"></a><a href="https://t.me/Alexminator"><img src="img/telegram-app-48.png" width="32px" height="32px"></a></td>
    <td align="center"><a href="https://t.me/Deltatronics"><img src="img/telegram-app-48.png" width="32px" height="32px"></a></td>
    
  </tr>
</table>

## Licencia

*El proyecto ALT se publica bajo la licencia <a href="https://github.com/alexminator/ALT_nano/blob/master/LICENSE.md">MIT</a>.*

## Contacto

> **_Necesita ayuda?_** 
**_Cont√°cteme üì® [alexminator99@gmail.com](mailto:alexminator99@gmail.com?Subject=ALT_nano_issues)_**

[![GitHub followers](https://img.shields.io/github/followers/alexminator.svg?label=Follow%20@alexminator&style=social)](https://github.com/alexminator/) [![Twitter Follow](https://img.shields.io/twitter/follow/alexminator?style=social)](https://twitter.com/alexminator99)

## Programas 
* [VSCODE](https://code.visualstudio.com/) -Editor de c√≥digo.
* [PlatFormio](https://platformio.org/) - IDE de programaci√≥n para C/C++, orientado al hardware.

## Agradecimientos 
* _A la comunidad cubana de Arduino._
* _A todo aquel que me brindo su ayuda cuando ten√≠a dudas, en especial a mi hijo._

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---
