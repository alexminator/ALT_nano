<h1 align="center">
  <img alt="ALT logo" src="https://github.com/alexminator/ALT_nano/blob/master/img/ALT_logo.png" width="300px"/><br/><strong>Another Level Tank</strong>
  
  <a href="https://github.com/alexminator/ALT_nano/blob/master/README_es.md">
    <img height="20px" src="https://img.shields.io/badge/ES-flag.svg?color=555555&style=flat-square&logo=data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3NTAgNTAwIj4NCjxwYXRoIGZpbGw9IiNjNjBiMWUiIGQ9Im0wLDBoNzUwdjUwMGgtNzUweiIvPg0KPHBhdGggZmlsbD0iI2ZmYzQwMCIgZD0ibTAsMTI1aDc1MHYyNTBoLTc1MHoiLz4NCjwvc3ZnPg0K">
  </a>
  <a href="https://github.com/alexminator/ALT_nano/blob/master/README.md">
    <img height="20px" src="https://img.shields.io/badge/EN-flag.svg?color=555555&style=flat-square&logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgNjAgMzAiIGhlaWdodD0iNjAwIj4NCjxkZWZzPg0KPGNsaXBQYXRoIGlkPSJ0Ij4NCjxwYXRoIGQ9Im0zMCwxNWgzMHYxNXp2MTVoLTMwemgtMzB2LTE1enYtMTVoMzB6Ii8+DQo8L2NsaXBQYXRoPg0KPC9kZWZzPg0KPHBhdGggZmlsbD0iIzAwMjQ3ZCIgZD0ibTAsMHYzMGg2MHYtMzB6Ii8+DQo8cGF0aCBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iNiIgZD0ibTAsMGw2MCwzMG0wLTMwbC02MCwzMCIvPg0KPHBhdGggc3Ryb2tlPSIjY2YxNDJiIiBzdHJva2Utd2lkdGg9IjQiIGQ9Im0wLDBsNjAsMzBtMC0zMGwtNjAsMzAiIGNsaXAtcGF0aD0idXJsKCN0KSIvPg0KPHBhdGggc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjEwIiBkPSJtMzAsMHYzMG0tMzAtMTVoNjAiLz4NCjxwYXRoIHN0cm9rZT0iI2NmMTQyYiIgc3Ryb2tlLXdpZHRoPSI2IiBkPSJtMzAsMHYzMG0tMzAtMTVoNjAiLz4NCjwvc3ZnPg0K">
  </a>
</h1>

<a name="readme-top"></a>

<h1 align="center">
  
[![GitHub repo size](https://img.shields.io/github/repo-size/alexminator/ALT_nano?logo=github&style=plastic)](https://github.com/alexminator/ALT_nano/)
[![GitHub License](https://img.shields.io/github/license/alexminator/ALT_nano.svg?logo=github&style=plastic&colorB=68B7EB)](https://github.com/alexminator/ALT_nano/blob/master/LICENSE) 
[![GitHub stars](https://img.shields.io/github/stars/alexminator/ALT_nano.svg?style=plastic&logo=github&color=yellow)](https://github.com/alexminator/ALT_nano/stargazers) 
[![GitHub forks](https://img.shields.io/github/forks/alexminator/ALT_nano.svg?logo=github&color=teal&style=plastic)](https://github.com/alexminator/ALT_nano/network/members)
[![GitHub top language](https://img.shields.io/github/languages/top/alexminator/ALT_nano?logo=github&style=plastic&color=blueviolet)](https://github.com/alexminator/ALT_nano/)
[![GitHub contributors](https://img.shields.io/github/contributors/alexminator/ALT_nano?logo=github&style=plastic)](https://github.com/alexminator/ALT_nano/)
[![Watchers](https://img.shields.io/github/watchers/alexminator/ALT_nano?logo=github&color=teal&style=plastic)](https://github.com/alexminator/ALT_nano/watchers)  
</h1> 

<h4 align="center">:star: Dame una estrella — me motivará a seguir mejorándolo!</h4>

<!-- TABLE OF CONTENTS -->
<details>
  <summary>Tabla de Contenido</summary>
  <ol>
    <li>
      <a href="#sobre-el-proyecto">Sobre el proyecto</a>
      <ul>
        <li><a href="#metas">Metas</a></li>
      </ul>
    </li>
    <li>
      <a href="#comencemos">Comencemos</a>
      <ul>
        <li><a href="#componentes">Componentes</a></li>
        <li><a href="#instalación">Instalación</a></li>
        <li><a href="#diagrama">Diagrama</a></li>
        <li><a href="#código">Código</a></li>
      </ul>
    </li>
    <li><a href="#por-hacer">Por hacer</a></li>
    <li><a href="#colaboradores">Colaboradores</a></li>
    <li><a href="#licencia">Licencia</a></li>
    <li><a href="#contacto">Contacto</a></li>
    <li><a href="#programas">Programas</a></li>
    <li><a href="#agradecimientos">Agradecimientos</a></li>
  </ol>
</details>

<!-- ABOUT THE PROJECT -->
## Sobre el proyecto

*Este proyecto es una versión más de un dispositivo para monitorear el nivel de agua en un tanque. El sistema de monitoreo de agua es un sistema de medición de nivel de líquido para mantener al usuario alertado en caso de desbordamiento de líquido o cuando el tanque se agota. Se fijará un sensor ultrasónico, que se colocará sobre el tanque apuntando al líquido. El sensor ultrasónico se utiliza para medir, comparar la profundidad del contenedor y el nivel de líquido. El estado del sistema podrá monitorearse mediante una pantalla LCD y un zumbador suena cuando el límite excede la cantidad de llenado permitida o decae por debajo de un límite fijado. Mediante el botón podremos silenciar las alarmas con una pulsación larga y también encender la luz de fondo del LCD para mejor visión con una pulsación corta.*

**Puedes ver una demo [aqui](https://wokwi.com/projects/356392498196222977).**
> **Warning** :
Una vez dentro de la web de WOKWI pulsa el botón PLAY para iniciar la simulación. Cuando comience la simulación, sonará la alarma de nivel alto. Mantenga presionado el botón hasta que se silencie la alarma. Haga clic en el sensor ultrasónico y aparecerá un control deslizante para simular los valores de lectura del sensor. Varíe los valores entre 25 y 104 cm para ver la animación de llenado del tanque. Donde 25 cm es tanque lleno y 104 cm (altura del tanque) es totalmente vacío. El sensor JSN-SR04T tiene una zona muerta de 25 cm.

### Metas 

- **_Monitoreo 24/7 del nivel de tanque_**
- **_Evitar derramamiento de agua por desbordamiento_**
- **_Evitar que el tanque quede vacio y deje la casa sin suminsitro de agua_**

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---

<!-- GETTING STARTED -->
## Comencemos

[![Arduino](https://img.shields.io/badge/Arduino-Project-teal.svg?colorA=teal&colorB=red&style=for-the-badge)](https://github.com/alexminator/ALT_nano/)

```js
         .8.          8 8888         8888888 8888888888
        .888.         8 8888               8 8888
       :88888.        8 8888               8 8888
      . `88888.       8 8888               8 8888
     .8. `88888.      8 8888               8 8888
    .8`8. `88888.     8 8888               8 8888
   .8' `8. `88888.    8 8888               8 8888
  .8'   `8. `88888.   8 8888               8 8888
 .888888888. `88888.  8 8888               8 8888
.8'       `8. `88888. 8 888888888888       8 8888

```
### Componentes

*Para este proyecto use un Arduino nano debido a su pequeño tamaño, al cual se le conectara un sensor y actuadores. Para mostrar la información se eligió una pantalla LCD de 20x4 con espacio suficiente para dibujar una animación del llenado del tanque. Un zumbador para la notificación y un botón para control. Para una mayor duración de vida del sensor ultrasónico se escogió el **JSN-SR04T** el cual es a prueba de agua. Si no posee este sensor y utiliza otro cerciórese de protegerlo contra la humedad.*

Los componentes necesarios son:

- **Arduino Nano**
- **Pantalla LCD 20x4**
- **Botón**
- **Zumbador**
- **Resitencia valor 10K**
- **Sensor ultrasónico a prueba de agua [JSN-SR04T](https://naylampmechatronics.com/img/cms/Datasheets/JSN-SR04T-2-0.pdf)**

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---

### Instalación 

*A continuación se muestra el diagrama de conexiones y una tabla con los pines que se conectarán.*

| ARDUINO PINS | LCD PINS    |  
| ------------ | ----------- | 
|  12-  `D12`  |   15 - `A`  |
|  11-  `D11`  |   4 - `RS`  |
|  10-  `D10`  |   6 - `E`   |
|  9-  `D9`    |   11 - `D4` |
|  8-  `D8`    |   12 - `D5` |
|  7-  `D7`    |   13 - `D6` |
|  6-  `D6`    |   14 - `D7` |
|    GND       |   16 - `K`  |
|    GND       |   1 - `VSS` |
|   VCC(5v)    |   2 - `VDD` |
| ARDUINO PINS | BUTTON PINS | 
|  3-  `D3`    |   1 - 3     | 
|    GND       |   2 - 4     |  
| ARDUINO PINS | BUZZER PINS |
|  4-  `D4`    |     +       |
|    GND       |     -       |
| ARDUINO PINS | JSN-SR04T   |
|  2-  `D2`    |  `TRIGGER`  |
|  3-  `D5`    |   `ECHO`    |
|   VCC(5v)    |    VCC      |
|    GND       |    GND      |

> **Warning** :
Del pin 1-3 del botón conectar una resistencia de 10 k a VCC (5v).

### Diagrama

![Diagram](https://github.com/alexminator/ALT_nano/blob/master/img/diagrama.jpg?raw=true)

> ### :point_right: Puede encontrar el esquema [aquí](https://github.com/alexminator/ALT_nano/blob/master/img/ALT-UNO.fzz). :star:

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>
---

## Código

*El código consta de una librería local llamada Tank que es la encargada del dibujo del tanque en la pantalla. Solo se usó una librería global **LiquidCrystal** para el manejo de la pantalla. Si posee una pantalla con I2C deberá sustituir esta librería por **LiquidCrystal_I2C** e inicializarla de forma diferente a como esta en el proyecto manteniendo el nombre como lcd.
El resto de las librerías son para el manejo de las alarmas, los tonos de las alarmas, animación del llenado del tanque, filtro de medición, depurado de código y tipo de letra.*

*Para activar el depurador el código debe quedar así:*

```c
#define DEBUGLEVEL DEBUGLEVEL_DEBUGGING
//#define DEBUGLEVEL DEBUGLEVEL_NONE
```
*Puede variar el nivel de depuración si así lo desea, para ello remítase a la librería **debug.h** y elija el nivel que necesite.
Se crean los objetos Button, Sensor y Draw. El objeto Button se encarga del control del botón, que sirve para silenciar las alarmas por alto y bajo nivel y encender la luz de fondo de la pantalla. El objeto sensor devuelve la distancia medida por el sensor ultrasónico para ser usada en el cálculo del volumen de líquido y el nivel de la columna liquida en porciento. Por último, el objeto draw dibujara cada uno de los 8 posibles [glyphs](https://www.techtarget.com/whatis/definition/glyph) que se pueden usar para generar la animación del llenado del tanque.*

*El sensor ultrasónico mide la cantidad de espacio vacío en el tanque, o sea la distancia que existe entre él y el agua contenida en el tanque. Por lo tanto, si conocemos la altura del tanque en vacío **(H)**, al restar la distancia **(D)** de espacio vacío sabremos la altura de la columna de líquido **(C)** que posee. Mira la figura a continuación.*

<td align="center"><img src="https://github.com/alexminator/ALT_nano/blob/master/img/fig%202.png" width=500px height=500px alt="fig2"/></td>

*Para el cálculo del volumen del tanque hay que tener en cuenta sus medidas, las mismas son introducidas como constantes en el código.*

> **Warning** :
Hay que destacar que el tanque para el que fue creado este código es atípico. Es un tanque rectangular que posee un tabique en el medio y lo convierte en 2 tanques.  Debido a ese particular se calcula también el volumen del tabique hasta la altura de la columna liquida para luego ser restado del volumen general y de como resultado el volumen real de líquido en el tanque.

*Si desean usar este código para el cálculo de volumen de líquido de su tanque deberán modificar las partes del código que calculan volumen que se encuentra en la función **get_volumen**. Solo debe tener en cuenta si su tanque es cilíndrico o rectangular y usar la formula correspondiente.
Les dejo este [enlace](https://www.calculatorsoup.com/calculators/construction/tank.php) a una web para el cálculo de volumen de tanques.* 

*Las constantes más importantes a tener en cuenta son:*
```c
#define DIST_TOPE    //altura del tanque en cm medida con el tanque vacío.
const int NIVEL_BAJO //nivel bajo porcentual a partir del cual se activa la alarma.
const int NIVEL ALTO //nivel alto porcentual a partir del cual se activa la alarma.
```
*La altura del tanque no debe superar la distancia máxima que puede medir su sensor ultrasónico. Defina un nivel bajo acorde a sus necesidades de llenado del tanque. El nivel alto por lo general se define cercano al 100%.*

> **Warning** :
Aunque se defina como nivel alto 100% y se alcance este nivel esto no significara que su tanque se desbordara. El sensor ultrasónico impermeable tiene una zona muerta de medición de 25 cm en el cual las lecturas no son confiables. Esto se tiene en cuenta en el código por lo que el 100% seria la altura del tanque menos 25 cm de rango muerto. Esto sería teniendo en cuenta que se posicione el sensor a la altura del tanque. Si se coloca más alto tenga cuidado con definir el nivel alto para la alarma. Véase la figura a continuación. 

<td align="center"><img src="https://github.com/alexminator/ALT_nano/blob/master/img/fig1.png" alt="fig2"/></td>

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---

## Por hacer

*Hacer una versión universal del proyecto que incluya las siguientes características.*

**_Por la parte del software:_**

+ Incluir un menú para configurar **TODAS** las variables posibles.
  - Tipo de tanque. Para un calculo preciso del volumen de agua.
      * Cilíndrico o rectangular.
  - Dimensiones del tanque. La altura del tanque puede ser introducida tanto de forma manual como automática. 
  - Nivel para activar la alarma por bajo y por alto.
  - Elección del modo de trabajo del dispositivo.  
      * Manual, el usuario toma las decisiones.  
      * Automático, al alcanzar el bajo nivel del tanque se medirá el nivel en la cisterna si es suficiente se activará la bomba y se llenará el tanque.
  - Elección del tono de alarma.
  - Incluir el flujo de agua entrante a mostrar en la pantalla.
  - Elección de la información a mostrar en pantalla.

**_Por la parte del hardware:_**

+ Poder usar diferentes pantallas.  
     - LCD.
     - OLED
+ Aumentar la cantidad de botones a 3, para una fácil navegación por el menú.
+ Agregar modulo relé para control de la bomba de llenado del tanque.
+ Agregar un sensor de flujo para protección de la bomba de llenado y contabilizar las cantidades de agua que entra al tanque.
+ Agregar un segundo sensor ultrasónico para medir el nivel de la cisterna y que el llenado sea automático al alcanzarse el bajo nivel. 
+ Y por último si el tiempo me alcanza hacer una versión con esp32 que incluya una web embebida y hacer todo el control desde su móvil.

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---

## Colaboradores

<table style="width:100%">
  <tr>
    <th><b>Alexminator</b></th>
    <th><b>20-EverGreen-2</b></th>
    
  </tr>
  <tr>
    <td align="center"><a href="https://github.com/alexminator"><img src="https://avatars.githubusercontent.com/u/9116486?s=400&v=4" width=150px height=150px alt="alexminator"/></a></td>
    <td align="center"><a href="https://github.com/20-EverGreen-2"><img src="https://avatars.githubusercontent.com/u/84293898?v=4" width="100px;" alt="20-EverGreen-2"></a></td>
    
  </tr>
  <tr>
    <td align="center"><a href="https://twitter.com/alexminator99"><img src="img/twitter-48.png" width="32px" height="32px"></a> <a href="https://www.facebook.com/alexander.rivasalpizar/"><img src="img/facebook-48.png" width="32px" height="32px"></a> <a href="https://www.linkedin.com/in/alexander-rivas-73532037/"><img src="img/linkedin-48.png" width="32px" height="32px"></a><a href="https://t.me/Alexminator"><img src="img/telegram-app-48.png" width="32px" height="32px"></a></td>
    <td align="center"><a href="https://t.me/Deltatronics"><img src="img/telegram-app-48.png" width="32px" height="32px"></a></td>
    
  </tr>
</table>

## Licencia

*El proyecto ALT se publica bajo la licencia <a href="https://github.com/alexminator/ALT_nano/blob/master/LICENSE.md">MIT</a>.*

## Contacto

> **_Necesita ayuda?_** 
**_Contácteme 📨 [alexminator99@gmail.com](mailto:alexminator99@gmail.com?Subject=ALT_nano_issues)_**

[![GitHub followers](https://img.shields.io/github/followers/alexminator.svg?label=Follow%20@alexminator&style=social)](https://github.com/alexminator/) [![Twitter Follow](https://img.shields.io/twitter/follow/alexminator?style=social)](https://twitter.com/alexminator99)

## Programas 
* [VSCODE](https://code.visualstudio.com/) -Editor de código.
* [PlatFormio](https://platformio.org/) - IDE de programación para C/C++, orientado al hardware.

## Agradecimientos 
* _A la comunidad cubana de Arduino._
* _A todo aquel que me brindo su ayuda cuando tenía dudas, en especial a mi hijo._

<a href="#readme-top"><img align="right" border="0" src="https://github.com/alexminator/ALT_nano/blob/master/img/up_arrow.png" width="22" ></a>

---
